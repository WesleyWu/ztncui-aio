# ä¸€åˆ†é’Ÿè‡ªå»ºzerotier-planet

<style>
red { color: red }
yellow { color: yellow }
</style>

ç§æœ‰éƒ¨ç½²zeroteir-planetæœåŠ¡

åŸºäº <https://github.com/kmahyyg/ztncui-aio> åˆ¶ä½œ 

**æ„Ÿè°¢** <https://gitee.com/jonnyan404/zerotier-planet> çš„è´¡çŒ®
**ç‰¹åˆ«æ„Ÿè°¢** <https://github.com/Jonnyan404/zerotier-planet/issues/11#issuecomment-1059961262> è¿™ä¸ªissueä¸­å„ä½ç”¨æˆ·çš„è´¡çŒ®ï¼ŒåŸºäºæ­¤issueä¸­ `@jqtmviyu` çš„æ­¥éª¤å’Œ`kaaass`çš„ [mkmoonworld](https://github.com/kaaass/ZeroTierOne/releases/tag/mkmoonworld-1.0) åˆ¶ä½œæˆç›®å‰çš„patchã€‚

# å¿…è¦æ¡ä»¶

- å…·æœ‰å…¬ç½‘ipçš„æœåŠ¡å™¨(éœ€è¦å¼€æ”¾4000/tcpç«¯å£,äº¦å¯è‡ªå®šä¹‰ç«¯å£ï¼‰
- å®‰è£… docker
- å®‰è£… docker-compose
- å»ºè®®ä½¿ç”¨è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼ˆæœ€ä½é…å³å¯ï¼‰
- å»ºè®®ä½¿ç”¨Ubuntu 22.04æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸æ¯”è¾ƒæ–°ï¼‰
- æ·»åŠ é˜²ç«å¢™è§„åˆ™
    ```shell
    åº”ç”¨ç±»å‹	æ¥æº            åè®®	ç«¯å£	ç­–ç•¥
    -------------------------------------------- 
    è‡ªå®šä¹‰	0.0.0.0/0	TCP	3443	å…è®¸		
    è‡ªå®šä¹‰	0.0.0.0/0	UDP	9993	å…è®¸		
    è‡ªå®šä¹‰	0.0.0.0/0	TCP	3180	å…è®¸		
    è‡ªå®šä¹‰	0.0.0.0/0	TCP	9993	å…è®¸		
    è‡ªå®šä¹‰	0.0.0.0/0	TCP	3000	å…è®¸		
    ```

# å¯¹ denv ç¯å¢ƒå˜é‡çš„æ”¹åŠ¨

- å¢åŠ  HTTP_PORT=3000 æ–¹ä¾¿ç”¨httpè®¿é—®
- ä¿®æ”¹ AUTOGEN_PLANET=1 è‡ªåŠ¨åˆ›å»º planet
- å¢åŠ  HTTP_ALL_INTERFACES=1 è®© Httpåœ¨æ‰€æœ‰ç½‘å¡ä¸Šç›‘å¬ï¼Œæ–¹ä¾¿ç”¨dockeræš´éœ²ç«¯å£åˆ°å®¿ä¸»æœºä¹‹åè®¿é—®

denv æ–‡ä»¶æœ€ç»ˆå†…å®¹å¦‚ä¸‹:
```shell
NODE_ENV=production
HTTPS_PORT=3443
HTTP_PORT=3000
ZTNCUI_PASSWD=password
MYDOMAIN=ztncui.docker.test
AUTOGEN_PLANET=1
HTTP_ALL_INTERFACES=1
```

# ç”¨æ³•

```
# æœ¬æ­¥éª¤å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä¸»è¦æ˜¯éœ€è¦ denv æ–‡ä»¶ï¼Œæ‰‹åŠ¨åˆ›å»ºæˆ–è€…æ‰‹åŠ¨é…ç½®ç¯å¢ƒå˜é‡ä¹Ÿå¯ä»¥
git clone https://github.com/WesleyWu/ztncui-aio
cd ztncui-aio

# å‡è®¾ä»¥ ubuntu ç”¨æˆ·åç™»å½•äº‘ä¸»æœº
# åˆ›å»ºç”¨æˆ·
sudo groupadd -g 2222 ztncui
sudo useradd -g ztncui -u 2222 ztncui
# è¿è¡Œ docker å®¹å™¨
# è¿™é‡Œçš„ /home/ubuntu/ztncui-aio å¯ä»¥æ˜¯ä½ æŒ‡å®šçš„ä»»æ„å®¿ä¸»æœºç›®å½•
sudo docker run -d -p3000:3000 -p3443:3443 -p3180:3180 -p9993:9993 -p9993:9993/udp \
    -v /home/ubuntu/ztncui-aio/ztncui:/opt/key-networks/ztncui/etc \
    -v /home/ubuntu/ztncui-aio/zt1:/var/lib/zerotier-one \
    -v /home/ubuntu/ztncui-aio/zt-mkworld-conf:/etc/zt-mkworld \
    --env-file ./denv \
    --restart always \
    --cap-add=NET_ADMIN --device /dev/net/tun:/dev/net/tun \
    --name ztncui \
    ghcr.io/kmahyyg/ztncui-aio
```

ä¹‹åå¯ä»¥æŸ¥çœ‹dockerè¿›ç¨‹ï¼Œä»¥åŠæ—¥å¿—

```shell
# sudo docker ps
CONTAINER ID   IMAGE                        COMMAND   CREATED          STATUS          PORTS                                                                                                                                                                                            NAMES
a04a4fa0da47   ghcr.io/kmahyyg/ztncui-aio   "/init"   25 minutes ago   Up 25 minutes   0.0.0.0:3000->3000/tcp, :::3000->3000/tcp, 3443/tcp, 0.0.0.0:3180->3180/tcp, :::3180->3180/tcp, 0.0.0.0:9993->9993/tcp, :::9993->9993/tcp, 8000/tcp, 0.0.0.0:9993->9993/udp, :::9993->9993/udp   ztncui

# sudo docker logs a04a4fa0da47
s6-rc: info: service s6rc-oneshot-runner: starting
s6-rc: info: service s6rc-oneshot-runner successfully started
s6-rc: info: service fix-attrs: starting
s6-rc: info: service entryinit: starting
s6-rc: info: service fix-attrs successfully started
s6-rc: info: service legacy-cont-init: starting
s6-rc: info: service legacy-cont-init successfully started
identity.secret written
identity.public written
Set Your IP Address to continue.
If you don't do that, I will automatically detect.
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    14  100    14    0     0     11      0  0:00:01  0:00:01 --:--:--    11
YOUR IP: xxx.xxx.xxx.xxx
YOUR DOMAIN: ztncui.docker.test
2023/05/05 14:16:53 startup flag parsed:  true
2023/05/05 14:16:53 config file read.
2023/05/05 14:16:53 config file unmarshalled.
2023/05/05 14:16:53 !WARNING! You've been created a world older than official, timestamp should be larger than 1567191349589.
2023/05/05 14:16:53 !You've been warned! WARN! WARN! WARN!
2023/05/05 14:16:53 since you've set plRecommend to true, we will automatically choose a new value.
2023/05/05 14:16:53 which might be much suitable for you.
2023/05/05 14:16:53 Generated Planet ID: xxxxxxxxxx, Birth TimeStamp: 1683296213970 . 
2023/05/05 14:16:53 !You've been warned! WARN! WARN! WARN!
2023/05/05 14:16:53 read world signing key failed:  open previous.c25519: no such file or directory  ,  open current.c25519: no such file or directory
2023/05/05 14:16:53 preflight check error occurred, but still can proceed.
2023/05/05 14:16:53 new world signing key generated.
2023/05/05 14:16:53 preflight check successfully complete.
2023/05/05 14:16:53 generating pre-sign message.
2023/05/05 14:16:53 pre-sign world generated and serialized successfully.
2023/05/05 14:16:53 world has been signed.
2023/05/05 14:16:53 new signed world are packed.
2023/05/05 14:16:53 packed new signed world has been written to file.
2023/05/05 14:16:53  
2023/05/05 14:16:53 write modified json successfully.
2023/05/05 14:16:53  
2023/05/05 14:16:53 now c language output: 
 
#define ZT_DEFAULT_WORLD_LENGTH  257
static const unsigned char ZT_DEFAULT_WORLD[ZT_DEFAULT_WORLD_LENGTH] = {0x01,0x00,0x00,0x00,0x00,0x32,0x63,0x01,0xcf,0x00,0x00,0x01,0x87,0xec,0x45,0xdb,0xd2,0x47,0x48,0xeb,0xde,0xdf,0x5d,0x61,0xe0,0x05,0xf1,0x21,0x1f,0xe2,0x3c,0xe9,0x15,0x3b,0x97,0x68,0x29,0x5f,0x8e,0x62,0x92,0x8a,0x01,0x40,0x16,0x75,0xb5,0x49,0x79,0xc1,0x60,0xa1,0x1d,0x5d,0x45,0xc1,0xdc,0x0e,0x13,0x9f,0xa5,0x05,0xfe,0x69,0xd7,0x74,0xae,0xae,0xdb,0xe1,0x3f,0x2b,0x9b,0x6b,0xc8,0x5b,0x00,0xe4,0x7e,0x63,0xb5,0xb1,0xcb,0x0a,0x84,0x15,0xe7,0x21,0x9c,0x26,0xc3,0x74,0x6f,0x77,0x3e,0x4f,0x21,0xcc,0xd3,0x16,0x70,0x42,0x9f,0x17,0xc5,0x20,0x12,0x48,0x0a,0xb3,0xed,0x2e,0xf8,0x20,0x4e,0xde,0xcf,0x4b,0x12,0x9e,0xa0,0xe4,0xee,0x16,0xc5,0x29,0x96,0x70,0xdd,0x1d,0xd4,0x41,0x09,0x73,0x69,0xeb,0x6f,0xa6,0x74,0x94,0x91,0x27,0x46,0x24,0x07,0x6f,0x69,0x56,0xb8,0x5c,0x34,0x70,0x72,0xee,0x8c,0x99,0xbd,0xc7,0x97,0xb6,0x9d,0x5a,0x64,0xf0,0x53,0xaa,0xa5,0xd1,0x67,0x94,0x27,0x24,0x22,0xfd,0x3a,0x1a,0x89,0x01,0x66,0x61,0xc8,0xaa,0x66,0x00,0x20,0x11,0x6a,0x87,0x04,0x85,0x57,0x2c,0x65,0x83,0x0e,0x98,0x78,0x22,0x40,0x27,0xf2,0xb3,0x73,0xef,0x1c,0x9d,0x74,0x3f,0xb9,0x3c,0xa3,0xe1,0x57,0x24,0x43,0x53,0xe1,0x49,0x68,0xbb,0xff,0xde,0x69,0x5c,0x86,0x45,0xa0,0x2e,0x7a,0x8e,0x82,0x6d,0x28,0x6c,0xc3,0xca,0x7e,0x74,0x79,0xf4,0xfd,0x9d,0xd2,0xfb,0x12,0x55,0xbe,0x28,0x00,0x01,0x04,0x65,0x2a,0x2a,0xf6,0x27,0x09};
 
planet successfully generated.
mkworld successfully ran.
s6-rc: info: service entryinit successfully started
s6-rc: info: service ztone: starting
s6-rc: info: service ztone successfully started
s6-rc: info: service ztncui: starting
s6-rc: info: service ztncui successfully started
s6-rc: info: service fileserv: starting
Set Your IP Address to continue.
If you don't do that, I will automatically detect.
s6-rc: info: service fileserv successfully started
s6-rc: info: service legacy-services: starting
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:s6-rc: info: service legacy-services successfully started
100    14  100    14    0     0     24      0 --:--:-- --:--:-- --:--:--    24
YOUR IP: xxx.xxx.xxx.xxx
YOUR DOMAIN: ztncui.docker.test
ZTNCUI ENV CONFIGURATION: 
NODE_ENV=production
MYADDR=xxx.xxx.xxx.xxx
HTTP_PORT=3000
HTTPS_PORT=3443
Default Password File Not Exists... Generating...
2023/05/05 14:16:54 Current Password: password
2023/05/05 14:16:54 Generate Done, check passwd file.
Cannot detect TLS Certs, Generating...
Warning: connect.session() MemoryStore is not
designed for a production environment, as it will leak
memory, and will not scale past a single process.
Listening for HTTP requests on port 3000 on all interfaces
Listening for HTTPS requests on port 3443 on all interfaces
```
å…¶ä¸­æ¯”è¾ƒé‡è¦çš„è¾“å‡ºä¿¡æ¯æ˜¯
```shell
Generated Planet ID: xxxxxxxxxx

planet successfully generated.
mkworld successfully ran.
Listening for HTTP requests on port 3000 on all interfaces
Listening for HTTPS requests on port 3443 on all interfaces
```

ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ï¼Œæˆ‘ä»¬è‡ªå·±çš„ planet å·²ç»åˆ›å»ºå¥½äº†

æµè§ˆå™¨è®¿é—® `http://xxx.xxx.xxx.xxx:3000` æ‰“å¼€webæ§åˆ¶å°ç•Œé¢ã€‚ç™»å½•
- ç”¨æˆ·å:admin
- å¯†ç :password

ç„¶å
- Add Network å¢åŠ æˆ‘ä»¬è‡ªå·±çš„è¡Œæ˜Ÿç½‘ç»œï¼Œè®°ä¸‹ç½‘ç»œå
- Easy Setup è®¾å®šIPåœ°å€æ± ï¼Œæˆ‘è®¾å®šçš„æ˜¯ 10.10.0.0/16

æµè§ˆå™¨è®¿é—® `http://xxx.xxx.xxx.xxx:3180` æ‰“å¼€planetæ–‡ä»¶ä¸‹è½½é¡µé¢

è¦ä¸‹è½½çš„æ˜¯ planet.custom è¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦å°†å…¶é‡å‘½åä¸º planet ä¿å­˜

# å„å®¢æˆ·ç«¯é…ç½®planet

é™äºç¯‡å¹…ï¼Œè¯·åˆ° <https://www.mrdoc.fun/doc/443/> æŸ¥é˜…

**<red>æ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦ç”¨æˆ‘ä»¬è‡ªå·±çš„ planet æ–‡ä»¶è¦†ç›–å®¢æˆ·ç«¯å®‰è£…ç›®å½•é‡Œçš„ planet æ–‡ä»¶</red>**

### ç§æœ‰ zerotier-planet çš„ä¼˜åŠ¿:
- è§£é™¤å®˜æ–¹ 25 çš„è®¾å¤‡è¿æ¥æ•°é™åˆ¶
- æå‡æ‰‹æœºå®¢æˆ·ç«¯è¿æ¥çš„ç¨³å®šæ€§

# Reference Link
- <https://www.mrdoc.fun/doc/443/>
- <https://gitee.com/jonnyan404/zerotier-planet>
- <https://github.com/key-networks/ztncui-aio>
